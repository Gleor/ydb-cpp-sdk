find_package(OpenSSL)
find_package(ZLIB)

add_library(python3-src-Modules)
target_compile_options(python3-src-Modules PRIVATE
  -DPy_BUILD_CORE_MODULE
)
target_include_directories(python3-src-Modules PRIVATE
  ${CMAKE_SOURCE_DIR}/contrib/libs/expat
  ${CMAKE_SOURCE_DIR}/contrib/libs/libbz2
  ${CMAKE_SOURCE_DIR}/contrib/libs/openssl
  ${CMAKE_SOURCE_DIR}/contrib/libs/zlib
  ${CMAKE_SOURCE_DIR}/contrib/restricted/libffi/include
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Include
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Include/internal
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/PC
)
target_link_libraries(python3-src-Modules PUBLIC
  contrib-libs-expat
  contrib-libs-libbz2
  OpenSSL::OpenSSL
  ZLIB::ZLIB
  libs-xz-liblzma
  contrib-restricted-libffi
)
target_sources(python3-src-Modules PRIVATE
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_abc.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_asynciomodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_bisectmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_blake2/blake2b_impl.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_blake2/blake2module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_blake2/blake2s_impl.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_bz2module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_codecsmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_collectionsmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_contextvarsmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_csv.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_ctypes/_ctypes.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_ctypes/callbacks.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_ctypes/callproc.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_ctypes/cfield.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_ctypes/stgdict.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_datetimemodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/_decimal.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/basearith.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/constants.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/context.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/convolute.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/crt.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/difradix2.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/fnt.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/fourstep.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/io.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/mpalloc.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/mpdecimal.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/numbertheory.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/sixstep.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_decimal/libmpdec/transpose.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_elementtree.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_hashopenssl.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_heapqmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_json.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_localemodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_lsprof.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_lzmamodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_math.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_multiprocessing/multiprocessing.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_multiprocessing/posixshmem.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_multiprocessing/semaphore.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_opcode.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_operator.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_peg_parser.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_pickle.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_queuemodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_randommodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_sha3/sha3module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_sre.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_ssl.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_stat.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_statisticsmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_struct.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_tracemalloc.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_weakref.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_xxsubinterpretersmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_xxtestfuzz/_xxtestfuzz.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_xxtestfuzz/fuzzer.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_zoneinfo.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/arraymodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/atexitmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/audioop.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/binascii.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/_codecs_cn.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/_codecs_hk.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/_codecs_iso2022.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/_codecs_jp.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/_codecs_kr.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/_codecs_tw.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cjkcodecs/multibytecodec.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/cmathmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/errnomodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/faulthandler.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/getbuildinfo.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/itertoolsmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/mathmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/md5module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/parsermodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/pyexpat.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/rotatingtree.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/selectmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/sha1module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/sha256module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/sha512module.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/socketmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/symtablemodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/unicodedata.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/zlibmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_cryptmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/_posixsubprocess.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/fcntlmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/grpmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/pwdmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/resource.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/syslogmodule.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/termios.c
  ${CMAKE_SOURCE_DIR}/contrib/tools/python3/src/Modules/spwdmodule.c
)
